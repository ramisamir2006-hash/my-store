<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <title>Ù…ØªØ¬Ø± Ø±Ø§Ù…ÙŠ Ø³Ù…ÙŠØ± Ø§Ù„Ø°Ù‡Ø¨ÙŠ</title>
    <style>
        :root { --main-gold: #D4AF37; --dark-bg: #1a1a1a; --text-white: #ffffff; }
        body { font-family: 'Cairo', sans-serif; background: var(--dark-bg); color: var(--text-white); margin: 0; padding-bottom: 80px; }
        .header { background: linear-gradient(45deg, #000, #444); padding: 20px; text-align: center; border-bottom: 2px solid var(--main-gold); }
        .category-bar { display: flex; overflow-x: auto; padding: 10px; gap: 10px; background: #222; }
        .cat-btn { background: none; border: 1px solid var(--main-gold); color: gold; padding: 5px 15px; border-radius: 20px; white-space: nowrap; }
        
        /* ÙƒØ±ÙˆØª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
        .products-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        .product-card { background: #282828; border-radius: 12px; overflow: hidden; border: 1px solid #333; position: relative; }
        .product-img { width: 100%; height: 150px; background: #444; object-fit: cover; }
        .product-info { padding: 10px; text-align: center; }
        .price { color: var(--main-gold); font-weight: bold; font-size: 1.2em; }
        
        /* Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª ÙˆÙ†ÙˆØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„ */
        .size-selector { margin: 5px 0; font-size: 0.8em; }
        .buy-btn { background: var(--main-gold); border: none; width: 100%; padding: 8px; font-weight: bold; cursor: pointer; }

        /* Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙˆÙ„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        .cart-panel, .admin-panel { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--dark-bg); z-index: 1000; display: none; overflow-y: auto; padding: 20px; box-sizing: border-box; }
        .form-group { margin-bottom: 15px; }
        input, select, textarea { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid var(--main-gold); background: #333; color: #fff; box-sizing: border-box; }
        
        .footer-nav { position: fixed; bottom: 0; width: 100%; background: #000; display: flex; justify-content: space-around; padding: 10px 0; border-top: 2px solid var(--main-gold); }
        .nav-item { color: #fff; text-decoration: none; font-size: 0.8em; text-align: center; cursor: pointer;}
        .hidden { display: none; }
        .show { display: block; }

        /* Ø³ØªØ§ÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© ÙÙŠ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© */
        .preview-imgs-scroll { display: flex; overflow-x: auto; gap: 5px; margin-top: 5px; }
        .preview-img-item { width: 60px; height: 60px; border-radius: 5px; object-fit: cover; border: 1px solid var(--main-gold); }
    </style>
</head>
<body>

<div class="header">
    <h2>âœ¨ Ù…Ù€Ø¬Ù€ÙˆÙ‡Ø±Ø§Øª Ø±Ø§Ù…Ù€ÙŠ Ø³Ù€Ù…Ù€ÙŠÙ€Ø± âœ¨</h2>
    <div id="userTypeBadge" style="color: gold; font-size: 0.9em;">Ø­Ø³Ø§Ø¨: Ø¹Ù…ÙŠÙ„ ØªØ¬Ø²Ø¦Ø©</div>
</div>

<div class="category-bar" id="cats">
    <button class="cat-btn" onclick="filterCat('Ø§Ù„ÙƒÙ„')">Ø§Ù„ÙƒÙ„</button>
    <button class="cat-btn" onclick="filterCat('ØºÙˆØ§ÙŠØ´')">ØºÙˆØ§ÙŠØ´</button>
    <button class="cat-btn" onclick="filterCat('Ø®ÙˆØ§ØªÙ…')">Ø®ÙˆØ§ØªÙ…</button>
    <button class="cat-btn" onclick="filterCat('Ø³Ù„Ø§Ø³Ù„')">Ø³Ù„Ø§Ø³Ù„</button>
</div>

<div class="products-grid" id="mainGrid"></div>

<div id="adminPanel" class="admin-panel">
    <h3 style="color: gold; text-align: center;">ğŸ›¡ï¸ Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h3>
    
    <div class="form-group">
        <label>ğŸ“¸ ØµÙˆØ± Ø§Ù„Ù…Ù†ØªØ¬ (Ø­ØªÙ‰ 10 ØµÙˆØ± - Ø¶Ø¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù‡Ù†Ø§):</label>
        <textarea id="p_imgs" placeholder="Ø¶Ø¹ Ø±Ø§Ø¨Ø· ÙƒÙ„ ØµÙˆØ±Ø© ÙÙŠ Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯..." rows="4" oninput="updatePreview()"></textarea>
    </div>

    <div class="form-group">
        <label>ğŸ’ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„:</label>
        <input type="text" id="p_name" placeholder="Ù…Ø«Ù„Ø§Ù‹: ØºÙˆÙŠØ´Ø© Ù„Ø§Ø²ÙˆØ±Ø¯ÙŠ Ù…Ù„ÙƒÙŠ" oninput="updatePreview()">
    </div>

    <div class="form-group">
        <label>ğŸ“ ÙˆØµÙ ØªØ´ÙˆÙŠÙ‚ÙŠ (ÙŠØ¸Ù‡Ø± Ù„Ù„Ø¹Ù…ÙŠÙ„):</label>
        <textarea id="p_desc" placeholder="Ø§ÙƒØªØ¨ Ø¬Ù…Ù„Ø© ØªØ¬Ø°Ø¨ Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†.." oninput="updatePreview()"></textarea>
    </div>

    <div class="form-group">
        <label>ğŸ’° Ø§Ù„Ø³Ø¹Ø± (Ø¬.Ù…):</label>
        <input type="number" id="p_price" oninput="updatePreview()">
    </div>

    <div class="form-group">
        <label>ğŸ“ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:</label>
        <input type="text" id="p_sizes" placeholder="60, 62, 64" oninput="updatePreview()">
    </div>

    <div id="previewArea" style="background: #333; padding: 10px; border-radius: 8px; margin-bottom: 15px; border: 1px dashed gold;">
        <p style="font-size: 0.8em; color: #aaa; margin: 0 0 5px 0;">ğŸ‘ï¸ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù†Ø´ÙˆØ±:</p>
        <div id="previewContent" style="font-size: 0.9em;">
            </div>
    </div>

    <button class="buy-btn" onclick="reviewAndPublish()">ğŸš€ Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ù†Ø§Ø© ÙÙˆØ±Ø§Ù‹</button>
    <br><br>
    <button class="buy-btn" style="background: red;" onclick="closePanels()">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<div id="cartPanel" class="cart-panel">
    <h3>ğŸ›’ Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</h3>
    <div class="form-group">
        <input type="text" id="cust_name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„">
    </div>
    <div class="form-group">
        <input type="tel" id="cust_phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
    </div>
    <div class="form-group">
        <textarea id="cust_addr" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„"></textarea>
    </div>
    <div class="form-group">
        <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:</label>
        <select id="ship_type">
            <option value="delivery">Ø´Ø­Ù† Ù„Ù„Ù…Ù†Ø²Ù„</option>
            <option value="pickup">Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø­Ù„</option>
        </select>
    </div>
    <div class="form-group">
        <label>Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…ÙØ¶Ù‘Ù„:</label>
        <input type="datetime-local" id="ship_time">
    </div>
    <div id="orderSummary"></div>
    <button class="buy-btn" style="background: #28a745;" onclick="confirmOrder()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø£ÙˆØ±Ø¯Ø± ğŸš€</button>
</div>

<div class="footer-nav">
    <div class="nav-item" onclick="showPanel('main')">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
    <div class="nav-item" onclick="showPanel('cart')">ğŸ›’ Ø§Ù„Ø³Ù„Ø©</div>
    <div class="nav-item" id="adminTab" onclick="showPanel('admin')" style="display: none;">âš™ï¸ Ø§Ù„Ù…Ø¯ÙŠØ±</div>
</div>

<script>
    let tg = window.Telegram.WebApp;
    tg.expand();

    const isAdmin = tg.initDataUnsafe.user?.id === 7020070481;
    if(isAdmin) document.getElementById('adminTab').style.display = 'block';

    let cart = [];
    let products = JSON.parse(localStorage.getItem('my_db')) || [
        {id:1, name: 'ØºÙˆÙŠØ´Ø© ÙƒÙ„ÙŠÙˆØ¨Ø§ØªØ±Ø§', price: 5000, cat: 'ØºÙˆØ§ÙŠØ´', sizes: '60,62', img: ''},
        {id:2, name: 'Ø®Ø§ØªÙ… Ø³ÙˆÙ„ÙŠØªÙŠØ±', price: 3500, cat: 'Ø®ÙˆØ§ØªÙ…', sizes: '18,19', img: ''}
    ];

    function renderProducts() {
        let html = '';
        products.forEach(p => {
            html += `
                <div class="product-card">
                    <div class="product-img"></div>
                    <div class="product-info">
                        <div class="product-name">${p.name}</div>
                        <div class="price">${p.price} Ø¬.Ù…</div>
                        <select class="size-selector" id="size_${p.id}">
                            ${p.sizes.split(',').map(s => `<option>${s}</option>`).join('')}
                        </select>
                        <button class="buy-btn" onclick="addToCart(${p.id})">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© ğŸ›’</button>
                    </div>
                </div>
            `;
        });
        document.getElementById('mainGrid').innerHTML = html;
    }

    function updatePreview() {
        let name = document.getElementById('p_name').value || "Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬";
        let price = document.getElementById('p_price').value || "0";
        let desc = document.getElementById('p_desc').value || "Ø§Ù„ÙˆØµÙ Ù‡Ù†Ø§..";
        let imgs = document.getElementById('p_imgs').value.split('\n').filter(url => url.trim() !== "");
        let sizes = document.getElementById('p_sizes').value || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";

        let imgHtml = '<div class="preview-imgs-scroll">';
        imgs.forEach(url => {
            imgHtml += `<img src="${url}" class="preview-img-item" onerror="this.src='https://via.placeholder.com/60'">`;
        });
        imgHtml += '</div>';

        document.getElementById('previewContent').innerHTML = `
            ${imgHtml}
            <b>${name}</b><br>
            <span style="color:gold">${price} Ø¬.Ù…</span><br>
            <small>${desc}</small><br>
            <small>Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª: ${sizes}</small>
        `;
    }

    function reviewAndPublish() {
        let name = document.getElementById('p_name').value;
        let price = document.getElementById('p_price').value;
        let desc = document.getElementById('p_desc').value;
        let imgs = document.getElementById('p_imgs').value.split('\n').filter(url => url.trim() !== "");
        let sizes = document.getElementById('p_sizes').value;

        if(!name || !price || imgs.length === 0) {
            tg.showAlert("ÙŠØ§ Ø±Ø§Ù…ÙŠØŒ Ù„Ø§Ø²Ù… ØªØ¶ÙŠÙ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø³Ø¹Ø± ÙˆØµÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„!");
            return;
        }

        let productData = {
            action: "publish_to_channel",
            name: name,
            price: price,
            description: desc,
            images: imgs,
            sizes: sizes,
            marketing_text: "ğŸ”¥ Ø¹Ø±Ø¶ Ù„ÙØªØ±Ø© Ù…Ø­Ø¯ÙˆØ¯Ø©! Ø§Ø·Ù„Ø¨ÙŠ Ø¯Ù„ÙˆÙ‚ØªÙŠ Ù‚Ø¨Ù„ Ù†ÙØ§Ø° Ø§Ù„ÙƒÙ…ÙŠØ© âœ¨"
        };

        tg.sendData(JSON.stringify(productData));
        tg.showPopup({message: "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© ÙˆØ§Ù„Ù†Ø´Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ù†Ø§Ø©.."});
    }

    function addToCart(id) {
        let p = products.find(i => i.id === id);
        let selectedSize = document.getElementById('size_'+id).value;
        cart.push({...p, selectedSize});
        tg.showPopup({message: "ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©"});
    }

    function showPanel(type) {
        closePanels();
        if(type === 'admin') document.getElementById('adminPanel').style.display = 'block';
        if(type === 'cart') {
            document.getElementById('cartPanel').style.display = 'block';
            updateOrderSummary();
        }
    }

    function closePanels() {
        document.getElementById('adminPanel').style.display = 'none';
        document.getElementById('cartPanel').style.display = 'none';
    }

    function updateOrderSummary() {
        let total = cart.reduce((s, i) => s + i.price, 0);
        document.getElementById('orderSummary').innerHTML = `<h4>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø¬.Ù…</h4>`;
    }

    function confirmOrder() {
        let orderData = {
            customer: document.getElementById('cust_name').value,
            phone:
